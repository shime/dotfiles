#! /usr/bin/env bash
# takes a screenshot
# uploads it to imgur
# opens it in browser
# copies the URL to clipboard
# saves it to ~/Pictures/screenshots

function uploadImage {
  curl -s -F "image=@$1" -F "key=486690f872c678126a2c09a9e196ce1b" https://imgur.com/api/upload.xml | \
  grep -o "<original_image>.*</original_image>" | \
  sed 's/\(<original_image>\|<\/original_image>\)//g'
}

if [ ! -d ~/Pictures/screenshots ]; then
  mkdir -p ~/Pictures/screenshots
fi

path=~/Pictures/screenshots/`date +%s`.png

scrot -s shot.png
uploadImage shot.png | xargs -I % sh -c 'xdg-open %; echo % | xclip -selection clipboard'
mv shot.png $path
